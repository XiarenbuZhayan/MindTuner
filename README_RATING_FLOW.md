# MindTuner 评分功能使用指南

## 功能概述

MindTuner 现在支持完整的评分流程，包括：
1. 冥想内容生成
2. 用户评分和评论
3. 感谢页面显示
4. 评分历史查看
5. 重新评分功能

## 使用流程

### 1. 启动后端服务器

在 `MindTuner/backend` 目录下运行：

```bash
# Windows
run_server.bat

# 或者手动启动
python start_server.py
```

服务器将在 `http://localhost:8080` 启动。

### 2. 启动前端应用

在 `MindTuner/frontend` 目录下运行：

```bash
flutter run
```

### 3. 使用评分功能

#### 步骤1：进入评分界面
- 在主界面点击评分测试按钮
- 或者通过导航栏的评分功能进入

#### 步骤2：查看生成内容
- 界面会显示生成的冥想内容
- 包括标题、描述和心情标签

#### 步骤3：进行评分
- 点击星星进行1-5星评分
- 在评论框中分享您的想法（可选）
- 点击"提交评分"按钮

#### 步骤4：查看感谢页面
- 评分提交成功后，会显示感谢页面
- 页面显示您的评分信息和感谢信息
- 可以选择"再次评分"或"查看历史"

#### 步骤5：查看评分历史
- 点击"查看历史"进入评分历史页面
- 查看所有已提交的评分记录
- 可以点击"添加新评分"或"重新评分"

## 功能特点

### 感谢页面
- ✅ 显示评分成功确认
- ✅ 展示评分详情（星级、类型、评论）
- ✅ 提供再次评分和查看历史选项
- ✅ 美观的UI设计

### 评分历史
- ✅ 显示所有评分记录
- ✅ 按时间排序
- ✅ 显示评分类型和星级
- ✅ 支持刷新和添加新评分
- ✅ 空状态提示和引导

### 重新评分
- ✅ 在任何评分记录中都可以重新评分
- ✅ 快速返回到评分界面
- ✅ 保持评分流程的连续性

## 技术实现

### 前端组件
- `MarkWidget`: 评分组件，支持感谢页面显示
- `TestRatingScreen`: 评分测试界面
- `RatingHistoryScreen`: 评分历史界面

### 后端API
- `POST /rating/`: 创建评分
- `GET /rating/user/{user_id}`: 获取用户评分历史
- `GET /rating/{rating_id}`: 获取特定评分
- `PUT /rating/{rating_id}`: 更新评分
- `DELETE /rating/{rating_id}`: 删除评分

### 数据模型
- `RatingRecord`: 评分记录模型
- `RatingType`: 评分类型枚举（冥想、心情、通用）

## 故障排除

### 后端连接问题
1. 确保后端服务器正在运行
2. 检查端口8080是否被占用
3. 验证Firebase配置是否正确

### 评分提交失败
1. 检查网络连接
2. 确保已选择评分等级
3. 查看控制台错误信息

### 评分历史不显示
1. 确保用户ID正确
2. 检查后端数据库连接
3. 尝试刷新页面

## 开发说明

### 添加新的评分类型
1. 在 `RatingType` 枚举中添加新类型
2. 更新 `_getRatingTypeText` 和 `_getRatingTypeColor` 方法
3. 在后端添加相应的处理逻辑

### 自定义感谢页面
1. 修改 `_buildThankYouPage` 方法
2. 调整UI样式和布局
3. 添加新的交互功能

### 扩展评分功能
1. 添加评分标签功能
2. 实现评分统计和分析
3. 添加评分推荐系统
